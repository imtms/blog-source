---
title: 移动光猫HN8546X6-10桥接补全SHELL改界面
categories: By TMs
tags: [network]
date: 2023-3-6 18:52:00
---

## 前言

最近刚因携号转网被赠送了移动千兆网络，附送了一个型号为HN8546X6-10的华为万兆XG-PON光猫，看了一下性能很不错。马上折腾起来。

由于我有好习惯每次装完网都问装维小哥要一下超级管理员密码，所以省掉了很多破解超级管理员密码的麻烦。本篇也不涉及任何光猫密码破解的工作。

所有的工具均来自各种论坛搜索，如果有需要可以邮件我索要。

## 0x01 进入后台

宽带装好第一件事自然是桥接，因为上海移动这边的超级管理员密码是设备注册的时候下发的随机生成的密码，甚至过段时间远程升级还会变，所以进入后台第一件事自然是删掉TR-069接口，关掉周期上报。

但是移动定制的界面好像禁止了TR-069接口的删除，F12大法也不管用，点击按钮就会被退出登录，而接口并没有被删掉。

查资料得知可以通过一些办法来切换回华为原生界面，解除所有功能限制。因为我已经注册成功移动网络，所以下面的操作十分谨慎，生怕需要重新设备注册而超管密码被重置无法进入。

## 0x02 开启telnet

刷机的第一步自然是开启Telnet或者SSH登录，由于我有超级管理员后台，非常简单就完成了，只需在安全-广域网访问配置选项卡中打勾即可开启。

开启后使用telnet连接，用默认用户root，默认密码Hw8@cMcc登录。su切换权限，再输入shell即可。随便使用一个ls指令看一下。结果报错ERROR::Command is not existed。看来这个shell是被阉割过的版本。首先要补全SHELL功能，使指令能够全部使用。

## 0x03 补全SHELL指令

在一些论坛找到了ONT组播配置工具V3-V5 2.0，据说有五个版本，我使用的是最新的一个版本。

还有一个r20shell.bin文件。虽然我是V5R021C00S050版本，也就是传说中的R21新版。但是据说这个r20的固件也可以使用。

光猫拔掉光纤，打开ONT组播配置工具，选择升级，选择r20shell.bin文件，连接光猫，点击启动。工具便在不停的组播寻找光猫。

如果找不到可以重启光猫，在重启过程中就会寻找到，右侧会出现光猫序列号和Loading，此时光猫所有灯都在同步闪烁，闪烁多次后工具提示Failed。没有关系，此时已经补全成功了。

## 0x04 修改hw_boardinfo文件改界面

再次telnet登录光猫，发现指令都可以使用了，cd /mnt/jffs2 进入文件夹，在电脑上打开一个tftpd32来接收发送文件。

使用

`tftp -p -l hw_boardinfo -r hw_boardinfo 电脑IP地址`

发送hw_boardinfo到电脑，使用HW Dollar2.exe打开hw_boardinfo，里面有非常多可以设置的项目，这次我们只需要修改obj.id = "0x0000001a"和obj.id = "0x0000001b"对应的obj.value = 改为 "COMMON"，即可改回华为ONT原本的管理界面。

只改1a虽然可以修改界面，但是因为移动后台的地址和原生的不同，会造成无法登陆后台。需要修改1b为COMMON来清除注册状态。因为移动是用password来认证的，所以在修改之前最好备份一下password。

修改完成后保存，然后使用

`tftp -g -l hw_boardinfo -r hw_boardinfo 电脑IP地址`

从电脑下载修改后的文件回光猫。然后reboot重启

## 0x05 重启后配置

重启后登录后台已经是HN8546X6-10的华为原生后台了，可以使用光猫的全部功能和设置，界面也好看了不少。依旧使用之前的超管密码登录，选择WEB业务发放，输入Password（有自动保存的可以不用输入），快乐的删掉TR-069，桥接INTERNET接口。插好光纤，一会儿就注册成功了。

测速，NAT类型检测一气呵成。终于拥有了1000M的NAT1网络。

## 0x06 题外话

既然拿到了Telnet权限，必然在光猫系统里游览一番，发现有一个hw_ctree.xml里面包含所有的配置信息，可以使用huaweiXML_CFG.exe进行解密修改，当然通过前面的修改原生界面，其实在后台也可以导出配置进行修改，可以新建后台超管账号之类非常方便。